# AlgoTrader3 World Model Configuration
# Based on Ha & Schmidhuber's World Models (2018)

seed: 42

# Data settings
data:
  file_path: "../data/NQ_2024_unix.csv"
  train_ratio: 0.6
  validation_ratio: 0.2
  test_ratio: 0.2
  warmup_bars: 35  # Bars needed for indicator calculation
  market_hours_only: false  # Use all hours (including pre/post market)
  market_open: "09:30"
  market_close: "16:00"
  timezone: "America/New_York"

# VAE (Vision Model)
vae:
  latent_dim: 12  # Compress 26 features → 12 dims (~2x compression)
  hidden_dims: [256, 128]
  beta: 0.001  # KL divergence weight (β-VAE)
  learning_rate: 0.001
  epochs: 10
  batch_size: 256

# MDN-RNN (Memory Model)
mdnrnn:
  hidden_dim: 256
  num_layers: 1
  num_mixtures: 5
  learning_rate: 0.001
  epochs: 20
  sequence_length: 50
  batch_size: 32
  grad_clip: 1.0

# Controller
controller:
  # Input: latent_dim (12) + hidden_dim (256) = 268
  # Output: 3 actions (Long, Short, Hold)
  action_dim: 3
  use_mlp: false       # Simple linear controller (268→3 = 807 params)
  mlp_hidden: 64       # Only used if use_mlp: true

# Risk Controller (trained separately after main model)
risk_controller:
  enabled: true        # Use risk controller in evaluation/live trading
  min_position_size: 0.0
  max_position_size: 2.0
  min_stop_loss_atr: 0.5
  max_stop_loss_atr: 4.0
  min_take_profit_atr: 1.0
  max_take_profit_atr: 6.0

# CMA-ES Training
cmaes:
  population_size: 64    # Good population for CMA-ES
  sigma: 0.5
  generations: 200       # More generations for convergence
  eval_episodes: 4       # Episodes per evaluation
  daily_episodes: false  # Disabled - use max_steps instead
  close_position_eod: false  # Disabled - no forced position close
  max_steps_per_episode: 2000  # Steps per episode
  patience: 20           # Early stopping: generations without improvement
  target_return: null    # Optional early stopping on target profit

# Dream Training
dream:
  enabled: false
  temperature: 1.0
  episode_length: 1000
  num_episodes: 100

# Hyperparameter Tuning (Optuna)
tuning:
  vae_trials: 10
  rnn_trials: 10
  output_dir: "./checkpoints/tuning"
  study_name: "world_model_tuning"
  # Storage for Optuna studies (supports resumption)
  storage: "sqlite:///checkpoints/tuning/optuna.db"

# Environment
environment:
  initial_balance: 10000.0
  position_size: 1
  point_value: 2.0  # MNQ futures: $2 per point (10x smaller than NQ)
  transaction_cost: 5.0  # Cost per trade in dollars (penalizes excessive trading)

# Technical Indicators (same as algotrader2)
indicators:
  supertrend:
    enabled: true
    period: 10
    multiplier: 3.0
  rsi:
    enabled: true
    period: 14
  macd:
    enabled: true
    fast_period: 12
    slow_period: 26
    signal_period: 9
  atr:
    enabled: true
    period: 14
  adx:
    enabled: true
    period: 14
  stochastic:
    enabled: true
    k_period: 14
    d_period: 3
  cci:
    enabled: true
    period: 20
  williams_r:
    enabled: true
    period: 14
  roc:
    enabled: true
    period: 10
  obv:
    enabled: true
  cmf:
    enabled: true
    period: 20
  sma:
    enabled: true
    period: 20
  ema:
    enabled: true
    period: 20
  disparity:
    enabled: true
    period: 14
  psar:
    enabled: true
    af_start: 0.02
    af_increment: 0.02
    af_max: 0.2
  vwap:
    enabled: true
  volume_ma:
    enabled: true
    period: 20
  time_features:
    enabled: true  # DOW_SIN, DOW_COS, MSO_SIN, MSO_COS

# Logging
logging:
  level: INFO
  save_dir: "./runs"
  save_frequency: 10  # Save every N epochs/generations
